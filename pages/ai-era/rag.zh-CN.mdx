import { Steps } from 'nextra/components'

# 🔗 RAG 实践分享

## 什么是 RAG（检索增强生成）

想象一下，如果你要写一篇关于“火星探测”的报告，但你对这个主题并不熟悉。你可能会先去网上搜索相关信息，然后根据找到的资料写报告。RAG（检索增强生成）就是这样一个过程，但是是机器来执行。

简单来说，RAG 做的事情分为两步：

1. **找资料**：就像你在网上搜索关于“火星探测”的信息一样，RAG 先在一个巨大的知识库中寻找跟提出的问题相关的信息。这一步确保它有足够的材料来回答问题。

2. **写答案**：有了这些资料后，RAG 再利用一个特别的程序（我们称之为生成模型）来“写出”回答或者生成相关的文本。这个程序会尝试用一种通顺、合理的方式来表达找到的信息。

简而言之，RAG 就是一个自动化的过程，帮助机器“学习”如何通过查找资料来更好地回答问题或生成文本。这使得机器生成的内容不仅仅凭空想象，而是基于实实在在的信息，因此通常更加准确和丰富。

## 为什么需要 RAG

RAG（检索增强生成）之所以重要，是因为它很好地解决了使用大语言模型时所遇到的种种问题，并大大提高了生成内容的质量和准确性：

1. **使生成的内容更具时效性**：大语言模型的数据时效性取决于其训练数据，完成训练后便不再更新，这使得大语言模型本身的所掌握的信息常常是过时的。通过加入 RAG 链路，模型可以获取最新信息并生成反映当前知识状态的内容。这一点对于那些需要最新数据支持的应用场景特别重要。

2. **处理知识密集型任务**：多数场景下，仅凭大语言模型已有的知识和数据，不足以处理那些需要广泛背景知识的任务，如撰写关于特定主题的详细报告。RAG 可通过快速整合不同知识库，检索相关信息来丰富其回答，使得生成的内容更加准确和信息丰富。

3. **提高生成文本的相关性和质量**：生成模型（如GPT系列）在没有直接访问到具体数据的情况下，可能会产生与问题不相关或者部分错误的回答（产生幻觉）。RAG 可通过先检索相关信息，然后基于这些信息生成文本，从而确保输出的质量和相关性。

4. **缓解数据稀缺问题**：对于一些特定领域或细分主题，可能缺乏足够的训练数据来训练一个高效的生成模型。RAG通过利用外部知识库来弥补这一点，即使是在数据稀缺的情况下也能提供高质量的输出。


综上，RAG 为解决复杂任务提供了一种有效的途径，通过结合检索和生成的方法，提升了机器理解和文本生成的能力，使得生成的内容不仅更加精确，也更加丰富和多样化。


## RAG 实践

RAG 链路可分为 4 个环节：

1. **提问改写（Rewriter）**：将用户输入的问题进行发散并回答，以获得针对原始问题的更多关键词
2. **关键词召回（Retriever）**：根据 Rewriter 提供的问答对，利用向量匹配、关键词匹配、搜索引擎等技术，从数据库中召回内容
3. **数据精排（Reranker）**：根据用户输入的原始问题，从 Retriever 提供的文本内容中，找到 n 条最相关的数据
4. **总结回答（Reader）**：理解用户输入的原始问题，阅读找到的 n 条最相关数据，总结并给出回答，回答时附上出处

下面我将分享一个实践案例，来说明整个 RAG 链路是如何工作的：

<Steps>

### 提问改写（Rewriter）

* **目标**：将用户输入的问题进行发散并回答，以获得针对原始问题的更多关键词
* **依赖能力**：提示词工程 + 大模型
* **输入**：用户原始问题
* **输出**：根据原始问题改写的多个问答对

#### 案例

  * 假设用户原始输入的问题为：「杭州周边有什么好玩的地方？」
  * 经过提问改写后，会生成以下问答对：
  ```
    1. 杭州周边有哪些历史文化名胜？杭州周边拥有丰富的历史文化资源。西湖是最著名的景点之一，以其“山水园林”被列为世界文化遗产。宋城也是一个不可错过的历史文化体验地，它是一个大型的历史文化主题公园。还有灵隐寺，是一座历史悠久的佛教寺院，闻名于世。
    2. 杭州周边适合亲子游的地方有哪些？杭州周边有很多适合亲子游的地方。例如，杭州野生动物世界是一个大型的野生动物园，家庭游客可以近距离接触和了解各种动物。另外，杭州乐园和宋城的宋城千古情景区也是亲子游的好选择，提供了多样的娱乐设施和表演。
    3. 杭州周边的自然风景区有哪些？杭州周边拥有多样的自然风景，其中黄山是最为人所知的自然风景区之一，以其奇松、怪石、云海、温泉四绝闻名。天目山也是值得一游的地方，有着丰富的生物多样性和清新的空气。此外，千岛湖以其清澈的水质和岛屿众多而成为热门的旅游目的地。
  ```
  * 如此一来，在下一步 Retriever 召回相关内容时，能使用的关键词就可以从原先的：`杭州`、`周边`、`好玩地方`，扩展成：`杭州`、`周边`、`历史文化名胜`、`西湖`、`山水园林`、`宋城`、`历史文化主题公园` 等，大大增加可召回的内容量

###  关键词召回（Retriever）

* **目标**：将 Rewriter 提供的问答对，利用向量匹配、关键词匹配、搜索引擎等技术，从数据库中召回内容
* **依赖能力**：向量搜索、数据图谱、搜索引擎
* **输入**：Rewriter 提供的问答对
* **输出**：为每个问答对各召回Top 50 文本内容

#### 案例

根据第 1 步 Rewriter 提供的问答对和里头包含的关键词（`杭州`、`周边`、`历史文化名胜`、`西湖`、`山水园林`、`宋城等`），从数据库中为每个问答对召回 50 条相关内容

###  数据精排（Reranker）

* **目标**：根据用户输入的原始问题，从 Retriever 提供的文本内容中，找到 n 条最相关的数据
* **依赖能力**：bg_rank 小模型
* **输入**：用户原始问题、Retriever 提供的文本内容
* **输出**：n 条最相关的文本内容

#### 案例

根据用户的原始问题「杭州周边欧什么好玩的地方？」，从第 2 步 Retriever 提供的一大堆文本内容中找到 Top n

### 总结回答（Reader）

* **目标**：理解用户输入的原始问题，阅读 Reranker 输出的 n 条最相关数据，总结并给出回答，回答时附上出处
* **依赖能力**：提示词工程+大模型
* **输入**：用户原始问题、Reranker 输出的 n 条最相关数据
* **输出**：带溯源的回答

#### 案例

根据用户的原始问题「杭州周边欧什么好玩的地方？」，以及第 3 步 Reranker 提供的 n 条最相关数据（包含它们的链接），作出回答输出：
```
杭州周边有许多值得探索的好玩地方，适合不同类型的游客：

1. 西湖：作为杭州的象征，西湖不仅是杭州必游的景点，也是周边游的起点。可以乘船游湖，漫步苏堤春晓，或在断桥残雪中体会古人的诗情画意。
2. 灵隐寺：位于杭州西湖区的灵隐飞来峰下，是一座历史悠久的佛教名寺。这里山水林木幽静，寺院古朴庄严，适合寻求心灵宁静的游客。
3. 宋城：位于杭州西湖区，是一个融合了宋代文化、历史、娱乐、演艺于一体的大型主题公园。特别推荐观看“宋城千古情”演出，感受震撼的视听盛宴。 

来源：[1]、[2]、[3]
```


</Steps>

## 总结

RAG（检索增强生成）是一种结合了检索（Retrieval）和生成（Generation）能力的内容生成方案。

从用户提问出发，发散出若干与之关联的问答对（发散时包含答案会更有利于发散出不同的关键词），拿问答对中包含的关键词从一个大型的知识库中检索相关信息，经过筛选、排序后，基于这些信息生成回答或文本，从而提高模型的生成质量和相关性。

RAG 方法结合了检索系统的高效性和生成模型的灵活性，能够在处理复杂的查询或任务时提供更加准确和丰富的输出。